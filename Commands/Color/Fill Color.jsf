/*
  Show Color Picker Command v1.0
  Ale Mu√±oz
  Bind to keyboard shortcut for fullscreen panel-less colorpicking goodness

  TODO: Add support for text selections

  shortcut: CTRL + C
**DOC**
Set fill color. If the selection is a group, every object inside the group will be filled with the selected color. If the selected object has a gradient fill, it will be replaced with a solid fill. If the selected object is a Symbol, a Color Effect will be applied to it.
**DOC**
*/
try {
  fw.runScript(fw.appJsCommandsDir + "/bs.js");
} catch(e){
  alert("This command requires the bs.js library\rGet it at http://bomberstudios.com/fireworks/");
};

var choice = fw.popupColorPickerOverMouse(fw.selection[0].pathAttributes.fillColor, true, false);

fw.selection.each(function(sel) {
  fw.selection = sel;
  if (sel.is_symbol()) {
    // TODO: do not replace effects in symbol, just add the color fill effect
    var original_effects = fw.selection[0].effectList;
    dom().applyEffects({ category:"UNUSED", effects:[ { Blendmode:0, Color:choice, EffectIsVisible:true, EffectMoaID:"{dd54adc0-a279-11d3-b92a000502f3fdbe}", Opacity:100, category:"Adjust Color", name:"Color Fill" } ], name:"UNUSED" });
  } else {
    // if the current object's fill is set to none, we'll have to assign a default fill before we can change the color.
    if(!sel.pathAttributes.fill){
      dom().setFillNColor({ category:"fc_Solid", ditherColors:[ "#000000", "#000000" ], edgeType:"antialiased", feather:0, gradient:null, name:"fn_Normal", pattern:null, shape:"solid", stampingMode:"blend opaque", textureBlend:0, webDitherTransparent:false }, "#000000");
    }
    // make the object's fill a solid color
    sel.pathAttributes.fill.category = 'fc_Solid';
    switch (choice) {
      case "#ffffff00":
        doc.setFillNColor(null, choice);
        break;
      default:
        doc.setFillColor(choice);
        break;
    }
  }
});